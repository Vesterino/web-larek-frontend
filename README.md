# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс товара

```
interface IProduct {
    id: string;
    title: string;
    description: string;
    price: number | null;
    category: string;
    image: string;
}
```

Интерфейс состояния всех элементов

```
interface IAppState {
    catalog: IProduct[];
    basket: string[];
    preview: string | null;
    order: IOrder
}
```

Интерфейс формы модального окна с методом оплаты и адресом

```
interface IOrderForm {
    payment?: 'card' | 'cash'; 
    address: string;
}
```

Интерфейс формы модального окна контактных данных

```
interface IContactsForm {
    email: string;
    phone: string;
}
```

Интерфейс совокупности данных заказа

```
interface IOrder extends IOrderForm, IContactsForm {
    items: string[];
}
```

Интерфейс данных для получения товаров с сервера

```
interface IItems {
    items: IProduct[];
}
```

Интерфейс для модели данных товаров 

```
interface IProductsData {
    products: IProduct[];
    preview: string | null;
}
```

Результата заказа

```
interface IOrderResults {
    id: string;
    total: number;
}
```

Интерфейс АПИ сервера

```
interface IApi {
    baseUrl: string;
    get<T>(uri: string): Promise<T>;
    post<T>(uri: string, data: object, method?: ApiPostMethods): Promise<T>;
}
```

Ошибки форм

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Запросы API

```
type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за изображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструкторе происходит:

`constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый URL и глобальные опции для всех запросов(опционально).

Методы:

- `handleResponse` - обрабатывается ответ от сервера и возвращается либо JSON-данные в случае успешного запроса, либо текст ошибки в случае неудачного запроса.
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс Component
Базовый класс, который содержит все методы управления DOM-элементами.

`constructor(container: HTMLElement)` - компонент принимает контейнер (любыми способами), в дальнейшем возвращается методом `render`.

Методы:

- `toggleClass` - добавляет или удаляет CSS-класс у указанного элемента. Позволяет управлять состоянием класса динамически, с учётом заданного флага.
- `setText` - устанавливает текстовое содержимое у указанного элемента.
- `setDisabled` - устанавливает или убирает блокировочный атрибут для указанного элемента.
- `setImage` - устанавливает для элемента изображения альтернативный текст.
- `render` - обрабатывает и возвращает DOM-элемент.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`;

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах события

#### Класс Model
Базовый класс для определения моделей и сообщений о их изменениях.

`constructor(data: Partial<T>, protected events: IEvents)` - создает экземпляр класса, инициализируя его с частичным набором данных и объектом событий для управления.

Методы:

- `emitChanges` - сообщает об изменении модели.

### Слой данных

#### Класс AppState
Класс отвечает за хранение и логику работы с данными отображаемых элементов на странице.
В полях класса хранятся следующие данные:

- basket: IProduct[] = [] - массив объектов корзины
- catalog: ProductItem[] - массив объектов каталога товаров
- order: IOrder = {
    payment: undefined,
    address: '',
    email: '',
    phone: '',
    items: [];
} - данные для формы заказа
- contacts: IContactsForm = {
    email: '',
    phone: '',
} - данные для формы контактов
- preview: string | null - id карточки, выбранной для просмотра в модальном окне
- formErrors: FormErrors = {} - ошибки форм

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- setCatalog(items: IProduct[]) - устанавливает товары в каталог на странице.
- clearBasket() - очищает корзину.
- getCatalog(): ProductItem[] - возвращает каталог товаров.
- addToBasket(product: IProduct) - добавляет товар в массив списка корзины.
- getBasket() - возвращает список товаров корзины.
- removeIsBasket(productId: string) - удаляет товар из массива списка корзины по id товара.
- setPreview(item: ProductItem | IProduct) - устанавливает просмотр модального окна товара.
- setOrderField<K extends keyof IOrderForm>(field: K, value: IOrderForm[K]) - обновляет значение указанного поля в форме заказ.
- setContactsField<K extends keyof IContactsForm>(field: K, value: IContactsForm[K]) - обновляет значение указанного поля в форме контактов.
- validateOrder() - валидация указанных полей в форме заказа.
- validateContacts() - валидация указанных полей в форме контактов.

#### Класс Contacts
Класс отвечает за хранение и логику работы с данными форм контактных данных

`constructor(container: HTMLFormElement, events: IEvents)` - создает экземпляр класса, предназначенного для работы с формами. Инициализирует корневой элемент формы и объект для управления событиями

В полях класса хранятся следующие данные:

- _button: HTMLButtonElement - кнопка модального окна контактов

Методы:

- сеттеры для установки значения в формы контактных данных

#### Класс LarekAPI
Класс отвечает за хранение и логику работы с данными определенных запросов на сервер.

`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - Конструктор используется для инициализации объекта, который будет взаимодействовать с API или серверами через HTTP-запросы. Он принимает базовые параметры для настройки запросов, такие как URL-адрес CDN, базовый URL и дополнительные опции для настройки запросов.

В полях класса хранятся следующие данные:
- cdn: string

Так же класс предоставляет набор методов для взаимодействия с этими данными
- orderProducts(order: IOrder): Promise<IOrderResults> - отправка заказа пользователя на сервер.

#### Класс Order
Класс отвечает за хранение и логику работы с данными заказа, формами заказа
`constructor(container: HTMLFormElement, events: IEvents, private appData: AppState)` - принимает контейнер для формы, брокер события и методы состояния приложения для дальнейших действия с кнопками.

В полях класса хранятся следующие данные:
- _selectedMethod: 'card' | 'cash' | undefined
- _button: HTMLButtonElement
- _methodButtons: NodeListOf<HTMLButtonElement>

Так же класс предоставляет набор методов для взаимодействия с этими данными
- init() - инициализирует сами кнопки для дальнейшего взаимодействия
- onMethodButtonClick(button: HTMLButtonElement) - обрабатывает нажатие на кнопку, изменяющую способ оплаты
- сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров, отображаемыми на странице.
Конструктор класс принимает инстант брокера событий\

`constructor(protected events: IEvents)`

В полях класса хранятся следующие данные:
- _products: IProducts[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Basket
Расширяет класс Component. Отвечает за модальное окно корзины, отображающее элементы списка товаров, цены и кнопки "оформления".

`constructor(container: HTMLElement, protected events: EventEmitter)` - Создаёт экземпляр класса, предназначенного для работы с интерфейсом, предоставляя доступ к корневому контейнеру и системе событий.

Поля класса:
- _list: HTMLElement - список товаров в корзине
- _total: HTMLElement - стоимость всей корзины
- _button: HTMLElement - кнопка оформления корзины

Методы:
- сеттеры и геттеры связанные с работой корзины

#### Класс BasketItem
Расширяет класс Component. Отвечает за элемент товара в корзине, отображающий его индекс, название и цену товара

`constructor(container: HTMLElement, private events: EventEmitter)` - Создаёт экземпляр класса, предназначенного для работы с интерфейсом, предоставляя доступ к корневому контейнеру и системе событий.к

Поля класса:
- _index: HTMLElement - индекс товара в корзине
- _title: HTMLElement - название товара в корзине
- _price: HTMLElement - цена товара в корзине

Методы:

- render(item: IBasketItem): HTMLElement - обрабатывает и возвращает элемент товара в список корзины

#### Класс Form
Расширяет класс Component. Отвечает за отображение ошибок форм и продолжением инициализации их.

`constructor(protected container: HTMLFormElement, protected events: IEvents)` - Инициализирует экземпляр класса, предоставляя доступ к HTML-форме и объекту управления событиями. Используется для работы с пользовательскими данными, валидацией формы и взаимодействием с другими компонентами через событийную модель.

Поля класса:
- _submit: HTMLButtonElement - кнопка отправки
- _errors: HTMLElement - элемент ошибок

Методы:
- onInputChange(field: keyof T, value: string) - метод обрабатывает изменения значений в полях формы или других элементах и эмиттирует событие, информируя о том, что значение в указанном поле было изменено.
- render(state: Partial<T> & IFormState) - метод выполняет рендеринг состояния формы, обновляя её элементы в соответствии с переданными данными.

#### Класс Modal
Расширяет класс Component. Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.\
`constructor(container: HTMLElement, protected events: IEvents)` - конструктор принимает контейнер, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр `EventEmitter` для возможности инициации событий.

Поля класса:
- _closeButton: HTMLButtonElement - кнопка-крестик для выключения модального окна.
- _content: HTMLElement - контейнер для поиска модального окна.

Методы:
- toggleModal(state: boolean = true) - реализует отображение модального окна
- handleEscape = (evt: Keyboard) - реализует выключение модального окна на клавишу "Escape"

#### Класс Success
Расширяет класс Component. Реализует функционал модального окна подтверждения.

`constructor(container: HTMLElement, actions: ISuccessActions)` - Этот конструктор инициализирует экземпляр класса, связывая его с контейнером в DOM и объектом, содержащим действия для успешных состояний.

Поля класса:
- _close: HTMLButtonElement - кнопка модального окна подтверждения
- _total: HTMLElement - стоимость заказа отправленная на сервер

Методы:
- сеттеры для установки стоимости заказа

#### Класс Page
Расширяет класс Component. Реализует страницу сайта. Представляет страницу приложения и предоставляет методы и свойства для упралвения ключевыми элементами интерфейса.

`constructor(element: HTMLElement, protected events: IEvents)` - конструктор принимает элемент, по которому в разметке страницы будет идентифицировано определенный элемент и экземпляр `EventEmitter` для возможности инициации событий.

Поля класса:
- _counter: HTMLElement - счетчик товаров в корзине
- _catalog: HTMLElement - каталог товара
- _wrapper: HTMLElement - основной контейнер страницы
- _basket: HTMLElement - кнопка корзины

Методы:
- сеттеры для установки данных из полей класса

#### Класс CatalogProduct
Расширяет класс Component. Отвечает за отображение товара, задавая в товаре данные названия, категории, картинки и цены. Класс используется для отображения товаров на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать товары разных вариантов верстки.\
Поля класса содержат элементы разметки элементов товара. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

`constructor(protected container: HTMLElement, events: IEvents)` - создает экземпляр класс, инициализируя контейнер для работы с DOM-элементами и объект для управления событиями.

Поля класса:
- _category: HTMLElement - элемент разметки для установки в карточку товара категории
- _title: HTMLElement - элемент разметки для установки в карточку товара названия
- _image: HTMLImageElement - элемент разметки для установки в карточку товара изображения
- _price: HTMLElement - элемент разметки для установки в карточку товара цену

Методы:
- render(productData: Partial<IProduct>): HTMLElement - метод возвращает полностью заполненный товар с установленными слушателями.
- сеттеры для установки данных в разметку.

#### Класс ModalProduct
Расширяет класс CatalogProduct. Отвечает за отображение в модальном окне товара с детальной информацией данных категории, названия, изображения, цены и описания.
Поля класса содержат элементы разметки элементов товара.

`constructor(protected container: HTMLElement, events: IEvents, actions?: IProductActions)` - создает экземпляр класс, инициализируя контейнер для работы с DOM-элементами, объект для управления событиями, а также объект для работы с товаром (опционально) 

Поля класса:
- _button: HTMLButtonElement - кнопка модального окна для добавления в корзину
- _description: HTMLElement - элемент разметки для установки в модальное окно карточки товара описание

Методы:
- render(productData: Partial<IProduct>): HTMLElement - метод возвращает полностью заполненный товар в модальном окне с установленными слушателями.
- сеттеры для установки данных в разметку карточки товара.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющую роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `basket:changed` - изменение массива товаров в корзине
- `preview:changed` - изменение данных в модальном окне карточки товара
- `products:changed` - изменение массива товаров на главной странице
- `formErrors:changed` - изменение валидации форм
- `order:changed` - изменение заполнения форм кнопок метода оплаты и поля адреса
- `contacts:changed` - изменение заполнения форм полей номера телефона и эмэйла

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - блокирование прокрутки при модальном окне
- `basket:open` - открытие модального окна с корзиной
- `order:open` - открытие модального окна с формами метода оплаты и адреса
- `contacts:open` - открытие модального окна с формами контактных данных
- `modal:close` - разблокирование прокрутки после модального окна
- `product:select` - выбор товара для отображения в модальном окне
- `order:submit` - отправка данных пользователя для оформления заказа