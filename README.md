# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IProduct {
    id: string;
    title: string;
    description: string;
    price: number | null;
    category: string;
    image: string;
}
```

Пользователь

```
interface IUser {
    method: HTMLButtonElement; 
    address: string;
    email: string;
    telephone: number;
}
```

Корзина

```
interface IOrder {
    id: string;
    total: number;
}
```

Интерфейс для модели данных товаров 

```
interface IProductsData {
    products: IProduct[];
    preview: string | null;
}
```

Интерфейс для модели данных корзины

```
interface IOrderData {
    order: IOrder[];
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой представления, отвечает за изображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом `IEvents`;

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров, отображаемыми на странице.
Конструктор класс принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- _products: IProducts[] - массив объектов товаров
- _preview: string | null - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- fillProducts(products: IProduct[]): void - заполняет страницу массивом товаров
- getProducts(productsId: string): IProduct[] - возвращает массив товаров по их id
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс OrderData
Класс отвечает за хранение и логику работы с корзиной и данными пользователя в ней.\
Конструктор класса принимает инстант брокера событий\
В полях хранятся следующие данные:

- order: IOrder[] - массив объектов товаров в корзине

Так же класс представляет набор методов для взаимодействия с этими данными.

- addProductOrder(product: IProduct): void - добавляет товар в начало массива корзины
- deleteProductOrder(productId: string): void - удаляет товар из массива. 
- clearOrder(list: IOrder[]): void - очищает массив корзины от товаров
- getOrder(productId: string): IOrder[] - возвращает массив товаров по их id
- checkValidation(data: IUser): boolean - проверяет объект с данными модальных окон пользователя на валидность.
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.
- constructor(selector: string, events: IEvents) - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithProduct
Расширяет класс Modal. Предназначен для реализации модального окна товара. При открытии модального окна отображает данные товара и возможность в последующем добавить в корзину сам товар.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка добавления
- _form: HTMLFormElement - элемент формы

Методы:
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна с отображения корзины, пустой или с товарами. При открытии модального окна получает коллекцию добавленных товаров.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка оформления покупки
- _form: HTMLFormElement - элемент формы

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки оформления
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithOrder
Расширяет класс Modal. Предназначен для реализации модального окна с оформлением заказа товара. При открытии модального окна отображает кнопки и поля ввода данных пользователя. При нажатии сабмита инициирует событие передавая в него объект с данными из полей ввода формы. Предоставляет методы для отображения ошибок и управления активностью кнопок "далее" и "оплатить".\
Поля класса:
- submitButton: HTMLButtonElement - кнопка продолжения и оплачивания
- _form: HTMLFormElement - элемент формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку "далее" или "оплатить"
- get form: HTMLElement - геттер для получения элемента формы


#### Класс ModalWithConfirm
Расширяет класс Modal. Предназначен для реализации модального окна с подтверждением оформленного заказа. При открытии модального окна отображает статус заказа. При нажатии на кнопку инициирует закрытие модального окна.\
Поля класса:
- submitButton: HTMLButtonElement - кнопка для закрытия модального окна и очищения корзины

#### Класс Product
Отвечает за отображение товара, задавая в товаре данные названия, категории, картинки и цены. Класс используется для отображения товаров на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать товары разных вариантов верстки.\
Поля класса содержат элементы разметки элементов товара. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Поля класса:
- productTitle: HTMLElement - элемент разметки для вывода названия товара
- productDescription: HTMLElement - элемент разметки для вывода описания товара
- productCategory: HTMLElement - элемент разметки для вывода категории товара
- productImage: HTMLImageElement - элемент разметки с изображением товара
- productPrice: HTMLElement - элемент разметки для вывода цены товара

Методы:
- setData(cardData: IProduct): void - заполняет атрибуты элементов товара данными.
- render(): HTMLElement - метод возвращает полностью заполненный товар с установленными слушателями
- геттер id возвращает уникальный id товара

#### Класс ProductsContainer
Отвечает за отображение блока с товарами на главной странице. Предоставляет метод `fillProducts(products: IProduct[])` для заполнения массивом товаров страницу и сеттер `container` для полного обновления содержимого.

#### Класс Basket
Отвечает за блок сайта с корзиной, содержит кнопку открытия товаров корзины для последующего оформления. Принимает в конструктор контейнер - элемент разметки блока корзины и экземпляр `EventEmitter` для инициации событий при нажатии пользователем на кнопки. Устанавливает в конструкторе слушатель на кнопку, при срабатывании которых генерируются соответствующие события\
В полях класса содержатся ссылка на элемент разметки блока.


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющую роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `product:selected` - изменение открываемой в модальном окне информации товара

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна с корзиной
- `order:open` - открытие модального окна с оформлением заказа
- `success:open` - открытие модального окна с подтверждением заказа
- `product:select` - выбор товара для отображения в модальном окне
- `card-basket:delete` - выбор товара для удаления в корзине
- `orderUser:input` - заполнение данных в форме с данными пользователя
- `product:submit` - добавление товара в корзину
- `basket:submit` - начало оформления товара
- `order:submit` - отправка данных пользователя для оформления товара
- `success:submit` - очищение корзины от товара после подтверждения оформления
- `order:validation` - событие, сообщающее о необходимости валидации формы оформления товара
